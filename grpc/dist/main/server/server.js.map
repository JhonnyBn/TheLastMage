{"version":3,"sources":["../../../src/main/server/server.js"],"names":["server","grpc","Server","SERVER_ADDRESS","PROTO_PATH","__dirname","proto","loadPackageDefinition","protoLoader","loadSync","keepCase","longs","String","enums","defaults","oneofs","join","call","callback","console","log","currentGame","sender","connections","push","write","user","text","datasourceUtil","loadMsgs","send","saveMsg","request","currentClient","processInput","addService","game","Actions","service","bind","ServerCredentials","createInsecure","start"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,IAAMA,MAAM,GAAG,IAAIC,IAAI,CAACC,MAAT,EAAf;AACA,IAAMC,cAAc,GAAG,cAAvB;AACA,IAAMC,UAAU,GAAGC,SAAS,GAAG,+BAA/B,C,CAEA;;AACA,IAAMC,KAAK,GAAGL,IAAI,CAACM,qBAAL,CACVC,WAAW,CAACC,QAAZ,CAAqBL,UAArB,EAAiC;AAC7BM,EAAAA,QAAQ,EAAE,IADmB;AAE7BC,EAAAA,KAAK,EAAEC,MAFsB;AAG7BC,EAAAA,KAAK,EAAED,MAHsB;AAI7BE,EAAAA,QAAQ,EAAE,IAJmB;AAK7BC,EAAAA,MAAM,EAAE;AALqB,CAAjC,CADU,CAAd,C,CAUA;;AACA,SAASC,IAAT,CAAcC,IAAd,EAAoBC,QAApB,EAA8B;AAC1BC,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AACAI,EAAAA,WAAW,CAACC,MAAZ,CAAmBC,WAAnB,CAA+BC,IAA/B,CAAoCP,IAApC;AACAA,EAAAA,IAAI,CAACQ,KAAL,CAAW;AAAEC,IAAAA,IAAI,EAAE,QAAR;AAAkBC,IAAAA,IAAI,EAAE;AAAxB,GAAX;AACH;;AAED,IAAMN,WAAW,GAAG,8BAApB;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAkBO,cAAc,CAACC,QAAf,CAAwBR,WAAxB,CAAlB;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,I,CAEA;;AACA,SAASS,IAAT,CAAcb,IAAd,EAAoBC,QAApB,EAA8B;AAE1BU,EAAAA,cAAc,CAACG,OAAf,CAAuBd,IAAI,CAACe,OAAL,CAAaL,IAApC;AACAN,EAAAA,WAAW,CAACC,MAAZ,CAAmBW,aAAnB,GAAmChB,IAAI,CAACe,OAAL,CAAaN,IAAhD;AACAP,EAAAA,OAAO,CAACC,GAAR,CAAYH,IAAI,CAACe,OAAjB;AACAX,EAAAA,WAAW,CAACa,YAAZ,CAAyBjB,IAAI,CAACe,OAAL,CAAaL,IAAtC;AAEH,C,CAED;;;AACA3B,MAAM,CAACmC,UAAP,CAAkB7B,KAAK,CAAC8B,IAAN,CAAWC,OAAX,CAAmBC,OAArC,EAA8C;AAAEtB,EAAAA,IAAI,EAAEA,IAAR;AAAcc,EAAAA,IAAI,EAAEA;AAApB,CAA9C;AAEA9B,MAAM,CAACuC,IAAP,CAAYpC,cAAZ,EAA4BF,IAAI,CAACuC,iBAAL,CAAuBC,cAAvB,EAA5B;AAEAzC,MAAM,CAAC0C,KAAP","sourcesContent":["import * as protoLoader from '@grpc/proto-loader';\r\nimport * as grpc from 'grpc';\r\nimport * as datasourceUtil from \"./datasource\"\r\nimport gameFactory from \"./factory/gameFactory\"\r\n\r\nconst server = new grpc.Server();\r\nconst SERVER_ADDRESS = \"0.0.0.0:5001\";\r\nconst PROTO_PATH = __dirname + '../../../../protos/game.proto';\r\n\r\n// Load protobuf\r\nconst proto = grpc.loadPackageDefinition(\r\n    protoLoader.loadSync(PROTO_PATH, {\r\n        keepCase: true,\r\n        longs: String,\r\n        enums: String,\r\n        defaults: true,\r\n        oneofs: true\r\n    })\r\n);\r\n\r\n// Receive message from client joining\r\nfunction join(call, callback) {\r\n    console.log(\"client connected\");\r\n    console.log(call)\r\n    currentGame.sender.connections.push(call);\r\n    call.write({ user: \"Server\", text: \"new user joined ...\" })\r\n}\r\n\r\nconst currentGame = gameFactory()\r\nasync () => await datasourceUtil.loadMsgs(currentGame);\r\n\r\n// Receive message from client\r\nfunction send(call, callback) {\r\n\r\n    datasourceUtil.saveMsg(call.request.text)\r\n    currentGame.sender.currentClient = call.request.user;\r\n    console.log(call.request)\r\n    currentGame.processInput(call.request.text);\r\n\r\n}\r\n\r\n// Define server with the methods and start it\r\nserver.addService(proto.game.Actions.service, { join: join, send: send });\r\n\r\nserver.bind(SERVER_ADDRESS, grpc.ServerCredentials.createInsecure());\r\n\r\nserver.start();"],"file":"server.js"}