{"version":3,"sources":["../../../../src/main/server/model/game.js"],"names":["Game","sender","action","players","Array","turn","currentPlayer","running","length","sendMsgToCurrentClient","sendMsgToAll","setNextPlayer","player","reset","nPlayersAlive","alive","name","getPlayerByName","undefined","push","Mage","sendMsgToAllButIgnoreCurrentClient","find","mage","names","map","slice","nplayers","disableShield","isGameFinished","congratulateWinner","resetGame","input","process","playerName"],"mappings":"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","sourcesContent":["import Mage from \"./mage\"\r\n\r\nexport default class Game {\r\n    constructor(sender, action) {\r\n        this.sender = sender;\r\n        this.players = new Array();\r\n        this.turn = 0;\r\n        this.currentPlayer = null;\r\n        this.running = 0;\r\n        this.action = action\r\n    }\r\n\r\n    // Inicia o jogo\r\n    run() {\r\n        if (this.players.length < 2) {\r\n            this.sender.sendMsgToCurrentClient(\"between 2 and 4 playter to start the game.\")\r\n            return\r\n        }\r\n\r\n        this.running = 1;\r\n        this.sender.sendMsgToAll(\"The game has started!\\n\");\r\n\r\n        this.setNextPlayer();\r\n    }\r\n\r\n    // Reseta o jogo\r\n    resetGame() {\r\n        for (var player of this.players) {\r\n            player.reset();\r\n        }\r\n        this.turn = 0;\r\n        this.currentPlayer = null;\r\n        this.running = 0;\r\n        this.sender.sendMsgToAll(\r\n            \"The game has been reset.\\nSay 'start' to begin a new game.\\n\"\r\n        );\r\n    }\r\n\r\n    // Reboota o jogo (reseta e remove personagens)\r\n    rebootGame() {\r\n        this.players = new Array();\r\n        this.turn = 0;\r\n        this.currentPlayer = null;\r\n        this.running = 0;\r\n        this.sender.sendMsgToAll(\r\n            \"The game has been rebooted.\\nSay 'join' to join again and 'start' to begin a new game.\\n\"\r\n        );\r\n    }\r\n\r\n    // Retorna True se haver somente um jogador vivo\r\n    isGameFinished() {\r\n        let nPlayersAlive = 0;\r\n        for (var player of this.players) {\r\n            if (player.alive) nPlayersAlive += 1;\r\n        }\r\n        return nPlayersAlive < 2;\r\n    }\r\n\r\n    // Parabeniza o vencedor do jogo\r\n    congratulateWinner() {\r\n        for (var player of this.players) {\r\n            if (player.alive) {\r\n                this.sender.sendMsgToAll(\r\n                    \"Congratulations \" + player.name + \"! You won the game!\\n\"\r\n                );\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Adiciona um novo jogador\r\n    addPlayer(name) {\r\n\r\n        // O nome nao pode estar vazio\r\n        if(name === \"\") {\r\n            this.sender.sendMsgToCurrentClient(\r\n                \"Your name cant be blank. Please choose another.\"\r\n            );\r\n            return;\r\n        }\r\n\r\n        // Se o nome ja existe, nao adiciona\r\n        if (this.getPlayerByName(name) != undefined) {\r\n            this.sender.sendMsgToCurrentClient(\r\n                \"Name already in use. Please choose another.\"\r\n            );\r\n            return;\r\n        }\r\n\r\n        this.players.push(new Mage(name, this.sender));\r\n        this.sender.sendMsgToCurrentClient(\"Welcome to the game, \" + name + \"!\\n\");\r\n        this.sender.sendMsgToAllButIgnoreCurrentClient(name + \" joined the game\");\r\n    }\r\n\r\n    // Retorna um jogador com base em seu NAME\r\n    getPlayerByName(name) {\r\n        return this.players.find(mage => mage.name == name)\r\n    }\r\n\r\n    // Lista o nome dos jogadores em jogo\r\n    listPlayers() {\r\n        let names = \"\";\r\n        this.players.map(player => names += player.name + \", \")\r\n        names = names.slice(0, -2)\r\n\r\n        if ( names === \"\" ) {\r\n            this.sender.sendMsgToCurrentClient(\"There are no players in the game.\");\r\n        } else {\r\n            this.sender.sendMsgToCurrentClient(\"Players in the game: \" + names);\r\n        }\r\n\r\n        return names\r\n    }\r\n\r\n    // Prepara a proxima rodada\r\n    setNextPlayer() {\r\n        let nplayers = this.players.length;\r\n        this.currentPlayer = this.players[\r\n            ((this.turn % nplayers) + nplayers) % nplayers\r\n        ];\r\n        this.turn += 1;\r\n        this.currentPlayer.disableShield();\r\n\r\n        // Se o jogador morreu, verifica se o jogo acabou\r\n        // Caso tenha acabado, reinicia o jogo\r\n        // Caso ainda nao tenha acabado, continua\r\n        if (!this.currentPlayer.alive) {\r\n            if (this.isGameFinished()) {\r\n                this.congratulateWinner();\r\n                this.resetGame();\r\n            } else this.setNextPlayer();\r\n        }\r\n    }\r\n\r\n    // Processa o texto de input para realizar as acoes do jogo\r\n    processInput(input) {\r\n        this.action.process(this, input)\r\n    }\r\n\r\n    isTheTurnOfThePlayer(playerName) {\r\n        return this.currentPlayer.name == playerName\r\n    }\r\n}\r\n"],"file":"game.js"}